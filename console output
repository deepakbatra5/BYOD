Push event to branch dev
12:13:01 Connecting to https://api.github.com using 2493969/****** (test connections)
Obtained Jenkinsfile from 4ae3e8340f1880aef873017fa947ffe35f389ed4
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins
 in /var/lib/jenkins/workspace/BYOD3_dev
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential jenkins-github-app
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/BYOD3_dev/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/deepakbatra5/BYOD.git # timeout=10
Fetching without tags
Fetching upstream changes from https://github.com/deepakbatra5/BYOD.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
using GIT_ASKPASS to set credentials test connections
 > git fetch --no-tags --force --progress -- https://github.com/deepakbatra5/BYOD.git +refs/heads/dev:refs/remotes/origin/dev # timeout=10
Checking out Revision 4ae3e8340f1880aef873017fa947ffe35f389ed4 (dev)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 4ae3e8340f1880aef873017fa947ffe35f389ed4 # timeout=10
Commit message: "run auto"
 > git rev-list --no-walk 76bc08bb3aa64c5b704d40daef52c06ed042d08d # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkout)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
using credential jenkins-github-app
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/BYOD3_dev/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/deepakbatra5/BYOD.git # timeout=10
Fetching without tags
Fetching upstream changes from https://github.com/deepakbatra5/BYOD.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
using GIT_ASKPASS to set credentials test connections
 > git fetch --no-tags --force --progress -- https://github.com/deepakbatra5/BYOD.git +refs/heads/dev:refs/remotes/origin/dev # timeout=10
Checking out Revision 4ae3e8340f1880aef873017fa947ffe35f389ed4 (dev)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 4ae3e8340f1880aef873017fa947ffe35f389ed4 # timeout=10
Commit message: "run auto"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Terraform Apply)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/BYOD3_dev/infra/terraform
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $AWS_ACCESS_KEY_ID or $AWS_SECRET_ACCESS_KEY
[Pipeline] {
[Pipeline] sh
+ terraform init
Initializing the backend...
Initializing provider plugins...
- Reusing previous version of hashicorp/template from the dependency lock file
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/local from the dependency lock file
- Using previously-installed hashicorp/local v2.6.1
- Using previously-installed hashicorp/template v2.2.0
- Using previously-installed hashicorp/aws v5.100.0

Terraform has been successfully initialized!
+ terraform apply -auto-approve -var-file=terraform.tfvars

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_instance.app_server will be created
  + resource "aws_instance" "app_server" {
      + ami                                  = "ami-03deb8c961063af8c"
      + arn                                  = (known after apply)
      + associate_public_ip_address          = (known after apply)
      + availability_zone                    = (known after apply)
      + cpu_core_count                       = (known after apply)
      + cpu_threads_per_core                 = (known after apply)
      + disable_api_stop                     = (known after apply)
      + disable_api_termination              = (known after apply)
      + ebs_optimized                        = (known after apply)
      + enable_primary_ipv6                  = (known after apply)
      + get_password_data                    = false
      + host_id                              = (known after apply)
      + host_resource_group_arn              = (known after apply)
      + iam_instance_profile                 = (known after apply)
      + id                                   = (known after apply)
      + instance_initiated_shutdown_behavior = (known after apply)
      + instance_lifecycle                   = (known after apply)
      + instance_state                       = (known after apply)
      + instance_type                        = "t3.micro"
      + ipv6_address_count                   = (known after apply)
      + ipv6_addresses                       = (known after apply)
      + key_name                             = "fullstack-cicd"
      + monitoring                           = (known after apply)
      + outpost_arn                          = (known after apply)
      + password_data                        = (known after apply)
      + placement_group                      = (known after apply)
      + placement_partition_number           = (known after apply)
      + primary_network_interface_id         = (known after apply)
      + private_dns                          = (known after apply)
      + private_ip                           = (known after apply)
      + public_dns                           = (known after apply)
      + public_ip                            = (known after apply)
      + secondary_private_ips                = (known after apply)
      + security_groups                      = (known after apply)
      + source_dest_check                    = true
      + spot_instance_request_id             = (known after apply)
      + subnet_id                            = (known after apply)
      + tags                                 = {
          + "Name" = "cicd-app-server"
        }
      + tags_all                             = {
          + "Name" = "cicd-app-server"
        }
      + tenancy                              = (known after apply)
      + user_data                            = (known after apply)
      + user_data_base64                     = (known after apply)
      + user_data_replace_on_change          = false
      + vpc_security_group_ids               = (known after apply)

      + capacity_reservation_specification (known after apply)

      + cpu_options (known after apply)

      + ebs_block_device (known after apply)

      + enclave_options (known after apply)

      + ephemeral_block_device (known after apply)

      + instance_market_options (known after apply)

      + maintenance_options (known after apply)

      + metadata_options (known after apply)

      + network_interface (known after apply)

      + private_dns_name_options (known after apply)

      + root_block_device (known after apply)
    }

  # aws_security_group.app_sg will be created
  + resource "aws_security_group" "app_sg" {
      + arn                    = (known after apply)
      + description            = "Allow SSH and HTTP"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 22
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 22
                # (1 unchanged attribute hidden)
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 8000
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 8000
                # (1 unchanged attribute hidden)
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 8089
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 8089
                # (1 unchanged attribute hidden)
            },
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 9997
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "tcp"
              + security_groups  = []
              + self             = false
              + to_port          = 9997
                # (1 unchanged attribute hidden)
            },
        ]
      + name                   = (known after apply)
      + name_prefix            = "app-sg"
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + tags_all               = (known after apply)
      + vpc_id                 = (known after apply)
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + app_server_instance_id = (known after apply)
  + app_server_public_ip   = (known after apply)
aws_security_group.app_sg: Creating...
aws_security_group.app_sg: Creation complete after 8s [id=sg-07979676c6fdd8b39]
aws_instance.app_server: Creating...
aws_instance.app_server: Still creating... [00m10s elapsed]
aws_instance.app_server: Creation complete after 16s [id=i-01ebc73b32a4f3daf]

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.

Outputs:

app_server_instance_id = "i-01ebc73b32a4f3daf"
app_server_public_ip = "34.204.182.191"
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Capture Terraform Outputs)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/BYOD3_dev/infra/terraform
[Pipeline] {
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ terraform output -raw app_server_public_ip
[Pipeline] sh
+ terraform output -raw app_server_instance_id
[Pipeline] echo
EC2 Public IP: 34.204.182.191
[Pipeline] echo
EC2 Instance ID: i-01ebc73b32a4f3daf
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Create Dynamic Inventory)
[Pipeline] sh
+ echo [splunk]
+ echo 34.204.182.191
+ cat dynamic_inventory.ini
[splunk]
34.204.182.191
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Wait for EC2 Health)
[Pipeline] withCredentials
Masking supported pattern matches of $AWS_ACCESS_KEY_ID or $AWS_SECRET_ACCESS_KEY
[Pipeline] {
[Pipeline] sh
+ aws ec2 wait instance-status-ok --instance-ids i-01ebc73b32a4f3daf
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Install Splunk)
[Pipeline] ansiblePlaybook
[BYOD3_dev] $ ansible-playbook infra/ansible/splunk.yml -i dynamic_inventory.ini --private-key /var/lib/jenkins/workspace/BYOD3_dev/ssh12641189067229484292.key -u ubuntu "--ssh-extra-args=-o StrictHostKeyChecking=no"

PLAY [splunk] ******************************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Host '34.204.182.191' is using the discovered Python interpreter at '/usr/bin/python3.10', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [34.204.182.191]

TASK [Update apt cache] ********************************************************
changed: [34.204.182.191]

TASK [Download Splunk] *********************************************************
changed: [34.204.182.191]

TASK [Install Splunk] **********************************************************
changed: [34.204.182.191]

TASK [Start Splunk] ************************************************************
changed: [34.204.182.191]

PLAY RECAP *********************************************************************
34.204.182.191             : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Test Splunk)
[Pipeline] ansiblePlaybook
[BYOD3_dev] $ ansible-playbook infra/ansible/test-splunk.yml -i dynamic_inventory.ini --private-key /var/lib/jenkins/workspace/BYOD3_dev/ssh18106340346964705224.key -u ubuntu

PLAY [splunk] ******************************************************************

TASK [Check Splunk Enterprise status] ******************************************
[WARNING]: Host '34.204.182.191' is using the discovered Python interpreter at '/usr/bin/python3.10', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.19/reference_appendices/interpreter_discovery.html for more information.
ok: [34.204.182.191]

TASK [Show Splunk status] ******************************************************
ok: [34.204.182.191] => {
    "splunk_status.stdout": "splunkd is running (PID: 23118).\nsplunk helpers are running (PIDs: 23119 23309 23352 23354 23398 23437)."
}

PLAY RECAP *********************************************************************
34.204.182.191             : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Validate Destroy)
[Pipeline] timeout
Timeout set to expire in 10 min
[Pipeline] {
[Pipeline] input
Approve Terraform DESTROY?
Proceed or Abort
Approved by Deepak Batra

[Pipeline] }
[Pipeline] // timeout
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Terraform Destroy)
[Pipeline] dir
Running in /var/lib/jenkins/workspace/BYOD3_dev/infra/terraform
[Pipeline] {
[Pipeline] withCredentials
Masking supported pattern matches of $AWS_ACCESS_KEY_ID or $AWS_SECRET_ACCESS_KEY
[Pipeline] {
[Pipeline] sh
+ terraform destroy -auto-approve
aws_security_group.app_sg: Refreshing state... [id=sg-07979676c6fdd8b39]
aws_instance.app_server: Refreshing state... [id=i-01ebc73b32a4f3daf]

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # aws_instance.app_server will be destroyed
  - resource "aws_instance" "app_server" {
      - ami                                  = "ami-03deb8c961063af8c" -> null
      - arn                                  = "arn:aws:ec2:us-east-1:522614117562:instance/i-01ebc73b32a4f3daf" -> null
      - associate_public_ip_address          = true -> null
      - availability_zone                    = "us-east-1f" -> null
      - cpu_core_count                       = 1 -> null
      - cpu_threads_per_core                 = 2 -> null
      - disable_api_stop                     = false -> null
      - disable_api_termination              = false -> null
      - ebs_optimized                        = false -> null
      - get_password_data                    = false -> null
      - hibernation                          = false -> null
      - id                                   = "i-01ebc73b32a4f3daf" -> null
      - instance_initiated_shutdown_behavior = "stop" -> null
      - instance_state                       = "running" -> null
      - instance_type                        = "t3.micro" -> null
      - ipv6_address_count                   = 0 -> null
      - ipv6_addresses                       = [] -> null
      - key_name                             = "fullstack-cicd" -> null
      - monitoring                           = false -> null
      - placement_partition_number           = 0 -> null
      - primary_network_interface_id         = "eni-0c133ca8701d29c16" -> null
      - private_dns                          = "ip-172-31-71-222.ec2.internal" -> null
      - private_ip                           = "172.31.71.222" -> null
      - public_dns                           = "ec2-34-204-182-191.compute-1.amazonaws.com" -> null
      - public_ip                            = "34.204.182.191" -> null
      - secondary_private_ips                = [] -> null
      - security_groups                      = [
          - "app-sg20251224121334537900000001",
        ] -> null
      - source_dest_check                    = true -> null
      - subnet_id                            = "subnet-0e371f3831b52fb40" -> null
      - tags                                 = {
          - "Name" = "cicd-app-server"
        } -> null
      - tags_all                             = {
          - "Name" = "cicd-app-server"
        } -> null
      - tenancy                              = "default" -> null
      - user_data_replace_on_change          = false -> null
      - vpc_security_group_ids               = [
          - "sg-07979676c6fdd8b39",
        ] -> null
        # (7 unchanged attributes hidden)

      - capacity_reservation_specification {
          - capacity_reservation_preference = "open" -> null
        }

      - cpu_options {
          - core_count       = 1 -> null
          - threads_per_core = 2 -> null
            # (1 unchanged attribute hidden)
        }

      - credit_specification {
          - cpu_credits = "unlimited" -> null
        }

      - enclave_options {
          - enabled = false -> null
        }

      - maintenance_options {
          - auto_recovery = "default" -> null
        }

      - metadata_options {
          - http_endpoint               = "enabled" -> null
          - http_protocol_ipv6          = "disabled" -> null
          - http_put_response_hop_limit = 1 -> null
          - http_tokens                 = "optional" -> null
          - instance_metadata_tags      = "disabled" -> null
        }

      - private_dns_name_options {
          - enable_resource_name_dns_a_record    = false -> null
          - enable_resource_name_dns_aaaa_record = false -> null
          - hostname_type                        = "ip-name" -> null
        }

      - root_block_device {
          - delete_on_termination = true -> null
          - device_name           = "/dev/sda1" -> null
          - encrypted             = false -> null
          - iops                  = 100 -> null
          - tags                  = {} -> null
          - tags_all              = {} -> null
          - throughput            = 0 -> null
          - volume_id             = "vol-0272cdd82eb3dbf3b" -> null
          - volume_size           = 8 -> null
          - volume_type           = "gp2" -> null
            # (1 unchanged attribute hidden)
        }
    }

  # aws_security_group.app_sg will be destroyed
  - resource "aws_security_group" "app_sg" {
      - arn                    = "arn:aws:ec2:us-east-1:522614117562:security-group/sg-07979676c6fdd8b39" -> null
      - description            = "Allow SSH and HTTP" -> null
      - egress                 = [
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 0
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "-1"
              - security_groups  = []
              - self             = false
              - to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ] -> null
      - id                     = "sg-07979676c6fdd8b39" -> null
      - ingress                = [
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 22
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 22
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 8000
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 8000
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 8089
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 8089
                # (1 unchanged attribute hidden)
            },
          - {
              - cidr_blocks      = [
                  - "0.0.0.0/0",
                ]
              - from_port        = 9997
              - ipv6_cidr_blocks = []
              - prefix_list_ids  = []
              - protocol         = "tcp"
              - security_groups  = []
              - self             = false
              - to_port          = 9997
                # (1 unchanged attribute hidden)
            },
        ] -> null
      - name                   = "app-sg20251224121334537900000001" -> null
      - name_prefix            = "app-sg" -> null
      - owner_id               = "522614117562" -> null
      - revoke_rules_on_delete = false -> null
      - tags                   = {} -> null
      - tags_all               = {} -> null
      - vpc_id                 = "vpc-0a9f83f4566ed91fb" -> null
    }

Plan: 0 to add, 0 to change, 2 to destroy.

Changes to Outputs:
  - app_server_instance_id = "i-01ebc73b32a4f3daf" -> null
  - app_server_public_ip   = "34.204.182.191" -> null
aws_instance.app_server: Destroying... [id=i-01ebc73b32a4f3daf]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 00m10s elapsed]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 00m20s elapsed]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 00m30s elapsed]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 00m40s elapsed]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 00m50s elapsed]
aws_instance.app_server: Still destroying... [id=i-01ebc73b32a4f3daf, 01m00s elapsed]
aws_instance.app_server: Destruction complete after 1m7s
aws_security_group.app_sg: Destroying... [id=sg-07979676c6fdd8b39]
aws_security_group.app_sg: Destruction complete after 2s

Destroy complete! Resources: 2 destroyed.
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // dir
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] sh
+ rm -f dynamic_inventory.ini
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline

GitHub has been notified of this commitâ€™s build result

Finished: SUCCESS
